declare @Path1 geometry = 'LINESTRING(0 0,0 995,-933 995,-933 711,-353 711,-353 1164,2 1164,2 812,365 812,365 306,235 306,235 606,123 606,123 -145,368 -145,368 29,1269 29,1269 -557,1199 -557,1199 -905,1506 -905,1506 -309,1105 -309,1105 2,777 2,777 -610,563 -610,563 -771,1051 -771,1051 -1584,1349 -1584,1349 -1883,542 -1883,542 -2674,-271 -2674,-271 -1728,687 -1728,687 -1470,-285 -1470,-285 -1542,413 -1542,413 -1712,282 -1712,282 -2264,268 -2264,268 -3024,1080 -3024,1080 -3227,988 -3227,988 -2744,1686 -2744,1686 -1944,2031 -1944,2031 -2891,1825 -2891,1825 -3882,1378 -3882,1378 -3050,1326 -3050,1326 -3184,380 -3184,380 -3076,-97 -3076,-97 -3894,-198 -3894,-198 -3110,211 -3110,211 -3087,570 -3087,570 -2106,112 -2106,112 -1320,557 -1320,557 -446,801 -446,801 -65,1007 -65,1007 21,1286 21,1286 -766,1969 -766,1969 -714,2709 -714,2709 -504,2871 -504,2871 -1252,3618 -1252,3618 -969,2654 -969,2654 -187,2268 -187,2268 18,1370 18,1370 792,1791 792,1791 1700,1511 1700,1511 1133,844 1133,844 831,49 831,49 9,-859 9,-859 -151,-580 -151,-580 -209,-1494 -209,-1494 619,-873 619,-873 957,109 957,109 1428,833 1428,833 919,1277 919,1277 1296,804 1296,804 1603,1135 1603,1135 1074,1990 1074,1990 600,2715 600,2715 -305,3124 -305,3124 -1186,3826 -1186,3826 -1024,3109 -1024,3109 -526,3567 -526,3567 -407,4311 -407,4311 -405,4229 -405,4229 -68,3241 -68,3241 -303,4072 -303,4072 -676,3950 -676,3950 -986,3843 -986,3843 -301,4707 -301,4707 -657,4920 -657,4920 -411,5293 -411,5293 -1220,5886 -1220,5886 -638,6374 -638,6374 209,7166 209,7166 27,7385 27,7385 -205,6690 -205,6690 -22,6854 -22,6854 -752,6194 -752,6194 -1333,5263 -1333,5263 -1297,4972 -1297,4972 -683,5380 -683,5380 245,5287 245,5287 -440,4408 -440,4408 -403,4295 -403,4295 -966,3955 -966,3955 -1178,3048 -1178,3048 -1735,2526 -1735,2526 -2345,1599 -2345,1599 -2334,2155 -2334,2155 -1763,2823 -1763,2823 -2597,3426 -2597,3426 -3004,4392 -3004,4392 -2759,3984 -2759,3984 -1937,4147 -1937,4147 -2202,3917 -2202,3917 -2346,3131 -2346,3131 -1867,3339 -1867,3339 -2648,2552 -2648,2552 -2794,3028 -2794,3028 -2233,3098 -2233,3098 -1354,3660 -1354,3660 -549,2763 -549,2763 -593,3472 -593,3472 -1366,4219 -1366,4219 -2172,4359 -2172,4359 -1219,3731 -1219,3731 -1971,3065 -1971,3065 -1055,2714 -1055,2714 -880,2210 -880,2210 -648,2673 -648,2673 -233,3165 -233,3165 -485,3135 -485,3135 -1059,3235 -1059,3235 -1392,3548 -1392,3548 -989,3480 -989,3480 -1965,2778 -1965,2778 -2170,1786 -2170,1786 -2722,1841 -2722,1841 -2506,2389 -2506,2389 -3400,3153 -3400,3153 -4319,3628 -4319,3628 -3663,4340 -3663,4340 -4417,4978 -4417,4978 -4384,5687 -4384,5687 -3741,5986 -3741,5986 -3590,6748 -3590,6748 -2823,6206 -2823,6206 -2242,5454 -2242,5454 -2943,4865 -2943,4865 -3255,5054 -3255,5054 -2333,4139 -2333,4139 -1358,4165 -1358,4165 -1114,4213 -1114,4213 -2085,4968 -2085,4968 -1196,4242 -1196,4242 -1070,5220 -1070,5220 -1345,4785 -1345,4785 -2077,3803 -2077,3803 -2731,3099 -2731,3099 -2829,3252 -2829,3252 -3812,4022 -3812,4022 -4241,4552 -4241,4552 -4786,4508 -4786,4508 -4822,4964 -4822,4964 -4380,4906 -4380,4906 -4701,5379 -4701,5379 -4044,5686 -4044,5686 -3730)',
	@Path2 geometry = 'LINESTRING(0 0,0 -999,880 -999,880 -1753,-115 -1753,-115 -1648,536 -1648,536 -886,987 -886,987 -274,1411 -274,1411 -490,1201 -490,1201 -1436,1258 -1436,1258 -751,1443 -751,1443 -517,675 -517,675 -1444,1267 -1444,1267 -899,2037 -899,2037 -443,1919 -443,1919 -421,2290 -421,2290 -1142,1353 -1142,1353 -998,1526 -998,1526 -661,1509 -661,1509 -1609,2229 -1609,2229 -992,1641 -992,1641 -1049,1899 -1049,1899 -2028,2131 -2028,2131 -2501,1680 -2501,1680 -3330,1595 -3330,1595 -4315,1262 -4315,1262 -4807,513 -4807,513 -5779,701 -5779,701 -5565,593 -5565,593 -5318,972 -5318,972 -5536,482 -5536,482 -5085,1064 -5085,1064 -4411,183 -4411,183 -3686,587 -3686,587 -4602,724 -4602,724 -3857,-245 -3857,-245 -4063,-725 -4063,-725 -3429,-53 -3429,-53 -2532,-237 -2532,-237 -3300,-1003 -3300,-1003 -3829,-686 -3829,-686 -4738,-760 -4738,-760 -4209,-791 -4209,-791 -3726,-1697 -3726,-1697 -2765,-2232 -2765,-2232 -3702,-2983 -3702,-2983 -4266,-2505 -4266,-2505 -4705,-1949 -4705,-1949 -4320,-2539 -4320,-2539 -4838,-3530 -4838,-3530 -5070,-3888 -5070,-3888 -6032,-3646 -6032,-3646 -5176,-3580 -5176,-3580 -6023,-3434 -6023,-3434 -5827,-2919 -5827,-2919 -6719,-2901 -6719,-2901 -7254,-2558 -7254,-2558 -6824,-2481 -6824,-2481 -7791,-1525 -7791,-1525 -7855,-2035 -7855,-2035 -7884,-2340 -7884,-2340 -8838,-2154 -8838,-2154 -8214,-2847 -8214,-2847 -7860,-3090 -7860,-3090 -8005,-3712 -8005,-3712 -7549,-2808 -7549,-2808 -7782,-3748 -7782,-3748 -7864,-3831 -7864,-3831 -8590,-4824 -8590,-4824 -8928,-5617 -8928,-5617 -8588,-6440 -8588,-6440 -8441,-7035 -8441,-7035 -8145,-7423 -8145,-7423 -8251,-7785 -8251,-7785 -8137,-6977 -8137,-6977 -8633,-6363 -8633,-6363 -9442,-5452 -9442,-5452 -8962,-5481 -8962,-5481 -9764,-4581 -9764,-4581 -8844,-3629 -8844,-3629 -8607,-4012 -8607,-4012 -9087,-3650 -9087,-3650 -9848,-2701 -9848,-2701 -10768,-2783 -10768,-2783 -11279,-2418 -11279,-2418 -10622,-1953 -10622,-1953 -10878,-1829 -10878,-1829 -11688,-1786 -11688,-1786 -12356,-1640 -12356,-1640 -13203,-1885 -13203,-1885 -12266,-2663 -12266,-2663 -13261,-2979 -13261,-2979 -12838,-2464 -12838,-2464 -13464,-3252 -13464,-3252 -13011,-3154 -13011,-3154 -12125,-2333 -12125,-2333 -11376,-2698 -11376,-2698 -10461,-1718 -10461,-1718 -10139,-1832 -10139,-1832 -10695,-2753 -10695,-2753 -11246,-3150 -11246,-3150 -11014,-3635 -11014,-3635 -11856,-4090 -11856,-4090 -10916,-3177 -10916,-3177 -11112,-3416 -11112,-3416 -11333,-3616 -11333,-3616 -10895,-3545 -10895,-3545 -11874,-3018 -11874,-3018 -11960,-2059 -11960,-2059 -11192,-2616 -11192,-2616 -10639,-3325 -10639,-3325 -11477,-3134 -11477,-3134 -12393,-3837 -12393,-3837 -13080,-3803 -13080,-3803 -12617,-4612 -12617,-4612 -12620,-4277 -12620,-4277 -12851,-4489 -12851,-4489 -13525,-4312 -13525,-4312 -13576,-4869 -13576,-4869 -14515,-4479 -14515,-4479 -14543,-4426 -14543,-4426 -15196,-4608 -15196,-4608 -14867,-5057 -14867,-5057 -15430,-5533 -15430,-5533 -15172,-5832 -15172,-5832 -15314,-4985 -15314,-4985 -15352,-4663 -15352,-4663 -15058,-4343 -15058,-4343 -14744,-4600 -14744,-4600 -14122,-4541 -14122,-4541 -13621,-5218 -13621,-5218 -14501,-4629 -14501,-4629 -13902,-4874 -13902,-4874 -14753,-4505 -14753,-4505 -14491,-4568 -14491,-4568 -13769,-4821 -13769,-4821 -14315,-4243 -14315,-4243 -13406,-3565 -13406,-3565 -13469,-3309 -13469,-3309 -13706,-2511 -13706,-2511 -13241,-2931 -13241,-2931 -12444,-3383 -12444,-3383 -11896,-2508 -11896,-2508 -11373,-3035 -11373,-3035 -11840,-2986 -11840,-2986 -11114,-3826 -11114,-3826 -10232,-3729 -10232,-3729 -10630,-4350 -10630,-4350 -10592,-3398 -10592,-3398 -10396,-3995 -10396,-3995 -9769,-4716 -9769,-4716 -10210,-5426 -10210,-5426 -10228,-6105 -10228,-6105 -10010)',
	@Intersections geometry;


SELECT @Intersections = @Path1.STIntersection(@Path2);

WITH AllIntersections AS (
SELECT
	@Intersections.STGeometryN(n.Number).ToString() as IntersectionPoints,
	ABS(Round(@Intersections.STGeometryN(n.Number).STX, 0)) + ABS(Round(@Intersections.STGeometryN(n.Number).STY, 0)) as IntersectDistance,
	dbo.fnLinestringBeforePoint (@Path1, @Intersections.STGeometryN(n.Number)).STLength() + 
		dbo.fnLinestringBeforePoint (@Path2, @Intersections.STGeometryN(n.Number)).STLength() as StepsToIntersect
FROM InterstellarTransport..Numbers n
	where n.Number <= @Intersections.STNumGeometries()
)
SELECT 
		MIN(StepsToIntersect) as MinStepDistance
	FROM AllIntersections

